# =============================================
# CAS Server Configuration for ISIC
# =============================================

# Server settings
server.port=8443
server.ssl.enabled=false
cas.server.name=https://auth.isic.ac.ma
cas.server.prefix=${cas.server.name}/cas

# Logging (production: WARN, debug: DEBUG)
logging.level.org.apereo.cas=WARN

# ===========================================
# Desactiver l'authentification statique
# ===========================================
cas.authn.accept.enabled=false

# ===========================================
# Authentification LDAP
# ===========================================
cas.authn.ldap[0].type=AUTHENTICATED
cas.authn.ldap[0].ldap-url=ldap://ldap:389
cas.authn.ldap[0].use-ssl=false
cas.authn.ldap[0].use-start-tls=false
cas.authn.ldap[0].base-dn=ou=People,dc=isic,dc=ac,dc=ma
cas.authn.ldap[0].search-filter=uid={user}
cas.authn.ldap[0].subtree-search=true
cas.authn.ldap[0].bind-dn=cn=admin,dc=isic,dc=ac,dc=ma
cas.authn.ldap[0].bind-credential=${LDAP_ADMIN_PASSWORD:admin_ldap_password}
cas.authn.ldap[0].principal-attribute-id=uid
cas.authn.ldap[0].principal-attribute-list=uid,cn,mail,sn,givenName,memberOf,employeeType
cas.authn.ldap[0].name=ISIC LDAP

# ===========================================
# Resolution d'attributs LDAP
# ===========================================
cas.authn.attribute-repository.ldap[0].ldap-url=ldap://ldap:389
cas.authn.attribute-repository.ldap[0].use-ssl=false
cas.authn.attribute-repository.ldap[0].base-dn=ou=People,dc=isic,dc=ac,dc=ma
cas.authn.attribute-repository.ldap[0].search-filter=uid={0}
cas.authn.attribute-repository.ldap[0].subtree-search=true
cas.authn.attribute-repository.ldap[0].bind-dn=cn=admin,dc=isic,dc=ac,dc=ma
cas.authn.attribute-repository.ldap[0].bind-credential=${LDAP_ADMIN_PASSWORD:admin_ldap_password}
cas.authn.attribute-repository.ldap[0].attributes.uid=uid
cas.authn.attribute-repository.ldap[0].attributes.cn=cn
cas.authn.attribute-repository.ldap[0].attributes.mail=mail
cas.authn.attribute-repository.ldap[0].attributes.sn=sn
cas.authn.attribute-repository.ldap[0].attributes.givenName=givenName
cas.authn.attribute-repository.ldap[0].attributes.memberOf=memberOf
cas.authn.attribute-repository.ldap[0].attributes.employeeType=employeeType

# ===========================================
# OAuth 2.0 Configuration
# ===========================================
cas.authn.oauth.grants.authorization-code.enabled=true
cas.authn.oauth.grants.refresh-token.enabled=true
cas.authn.oauth.access-token.max-time-to-live-in-seconds=28800
cas.authn.oauth.refresh-token.time-to-kill-in-seconds=2592000

# User profile endpoint
cas.authn.oauth.user-profile-view-type=NESTED

# ===========================================
# Service Registry (JSON)
# ===========================================
cas.service-registry.core.init-from-json=true
cas.service-registry.json.location=file:/etc/cas/services

# ===========================================
# Ticket settings
# ===========================================
cas.ticket.tgt.max-time-to-live-in-seconds=28800
cas.ticket.tgt.time-to-kill-in-seconds=7200

# ===========================================
# Webflow
# ===========================================
cas.webflow.autoconfigure=true

# ===========================================
# Branding ISIC
# ===========================================
# Les ressources statiques externes ont priorite sur le classpath.
# On surcharge css/cas.css et js/cas.js avec nos versions custom
# qui incluent le branding ISIC (logo, labels FR, couleurs).
spring.web.resources.static-locations=file:/etc/cas/static/,classpath:/static/

# ===========================================
# Logout / SLO
# ===========================================
cas.logout.follow-service-redirects=true
cas.logout.redirect-parameter=service
cas.slo.disabled=false
cas.slo.async=true
